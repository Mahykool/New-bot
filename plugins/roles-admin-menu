// plugins/roles-admin-menu.js
import { 
    getUserRoles, 
    getUserLevel, 
    listRoles 
} from '../lib/lib-roles.js'

const handler = async (m, { conn, args }) => {
    const sender = m.sender
    const isCreator = global.owner?.includes(sender)

    if (!isCreator) return m.reply('âŒ Solo el *CREADOR* puede ver este menÃº.')

    const target = m.mentionedJid?.[0] || sender
    const roles = getUserRoles(target)
    const level = getUserLevel(target)
    const allRoles = listRoles()

    let txt = `ğŸ›¡ï¸ *MENÃš DE MODERACIÃ“N DE ROLES*\n\n`

    txt += `ğŸ‘¤ *Usuario:* @${target.split('@')[0]}\n`
    txt += `ğŸ­ *Roles:* ${roles.length ? roles.join(', ') : 'Ninguno'}\n`
    txt += `ğŸ“Š *Nivel:* ${level}\n\n`

    txt += `âš™ï¸ *Acciones rÃ¡pidas:*\n`
    txt += `â€¢ .addrole @user <rol>\n`
    txt += `â€¢ .removerole @user <rol>\n`
    txt += `â€¢ .setrole @user <rol>\n`
    txt += `â€¢ .roles @user\n`
    txt += `â€¢ .roleinfo <rol>\n\n`

    txt += `ğŸ“Œ *Roles disponibles:*\n\n`
    for (const r of allRoles) {
        txt += `${r.icon || ''} *${r.role}*\n`
        txt += `â€¢ Nivel: ${r.level}\n`
        txt += `â€¢ ${r.description}\n\n`
    }

    return m.reply(txt, null, { mentions: [target] })
}

handler.command = ['rolesadmin', 'rolesmod']
handler.tags = ['roles']
handler.group = true

export default handler
